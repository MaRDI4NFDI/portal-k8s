repos:
  - repo: local
    hooks:
      - id: sops-encryption-check
        name: Check SOPS encryption on secrets
        entry: |
          bash -c '
          for file in $(git diff --cached --name-only | grep -E "\.(yaml|yml)$"); do
            if [ -f "$file" ] && grep -q "kind.*Secret" "$file" && ! grep -q "sops:" "$file"; then
              echo "ERROR: $file contains unencrypted Kubernetes secret. Please encrypt with: sops -e -i $file"
              exit 1
            fi
          done
          '
        language: system
        pass_filenames: false
        stages: [pre-commit]
        exclude: '.*example.*\.yaml$'