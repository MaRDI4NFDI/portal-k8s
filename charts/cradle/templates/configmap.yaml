apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}-entrypoint
data:
  entrypoint.sh: |
    #!/usr/bin/env bash

    # Create oauth.ini from environment variables
    if [ -n "$OAUTH_CONSUMER_KEY" ] && [ -n "$OAUTH_CONSUMER_SECRET" ]; then
        cat > /var/www/html/cradle/oauth.ini <<EOF
    [settings]
    agent = Cradle
    consumerKey = ${OAUTH_CONSUMER_KEY}
    consumerSecret = ${OAUTH_CONSUMER_SECRET}
    EOF
        echo "oauth.ini created successfully"
    else
        echo "Warning: OAUTH_CONSUMER_KEY or OAUTH_CONSUMER_SECRET not set"
    fi

    # Start Apache
    docker-php-entrypoint apache2-foreground