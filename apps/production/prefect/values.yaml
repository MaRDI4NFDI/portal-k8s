apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: prefect-server
spec:
  chart:
    spec:
      version: "2025.10.23195705"
  values:
    server:
      loggingLevel: WARNING

      #uiConfig:
      #  prefectUiApiUrl: "https://prefect.portal.mardi4nfdi.de/api"
      #  prefectUiStaticDirectory: "/ui_build"
            
      resources:
        requests:
          cpu: 500m
          memory: 512Mi
        limits:
          cpu: "1"
          memory: 1Gi
      
      livenessProbe:
        enabled: true
      
      readinessProbe:
        enabled: true
          
    serviceAccount:
      create: true
      annotations: {}
    
    service:
      type: ClusterIP
      port: 4200
      targetPort: 4200
    
    ingress:
      enabled: false

    secret:
      create: false
    
    postgresql:
      enabled: true      
      auth:
        existingSecret: "prefect-server-postgresql"
        persistence:
          enabled: true
          size: 20Gi
        resources:
          requests:
            cpu: 250m
            memory: 256Mi
          limits:
            cpu: 1000m
            memory: 1Gi      
      image:
        repository: bitnamilegacy/postgresql
        tag: 14.13.0    